/*
all the code where Query is used must be substituted for shared_ptr<Query_base>
*/